@using ForkYeah.Models.Default;

@model Archive

@using (Bs.Div().AddCss("relative-wrapper").Begin())
{
    using (Bs.Div().AddCss("scroll-wrapper").Begin())
    {
        using(Bs.Div().AddCss("padded-top").Begin())
        {
            if(Model.ListItems.Count() == 0)
            {
                @Bs.Paragraph("There are currently no archived projects that match your filter.")
                @Bs.Element("hr")
            }
            else
            {
                DateTime date = DateTime.MinValue;
                foreach(RepositoryListItem repo in Model.ListItems)
                {
                    if(repo.DbAdded.Date != date)
                    {
                        date = repo.DbAdded.Date;
                        @Bs.Heading4(date.ToString("D"))
                        @Bs.Element("hr")
                    }
                    Html.RenderPartial(MVC.Default.Views.ViewNames._Repository, repo);
                    @Bs.Element("hr")
                }
            }
            using (var pager = Bs.Pager().Begin())
            {
                @pager.Page("Previous (Newer)").SetAlignment(PageAlignment.Previous).SetDisabled(!Model.NewerPage.HasValue).SetId("newer-page")
                @pager.Page("Next (Older)").SetAlignment(PageAlignment.Next).SetDisabled(!Model.OlderPage.HasValue).SetId("older-page")
            }
        }
    }
}

<script>
    $( ".repository-link" ).click(function() {
        var detailsAction = "@(Url.JavaScriptReplaceableUrl(MVC.Default.Details()))";
        detailsAction = detailsAction.replace("{@(MVC.Default.DetailsParams.owner)}", $(this).data("owner"));
        detailsAction = detailsAction.replace("{@(MVC.Default.DetailsParams.name)}", $(this).data("name"));
        $("#content").load(detailsAction, {});
        history.pushState({}, null, detailsAction);
        return false;
    });

    @if(Model.NewerPage.HasValue)
    {
        <text>
            $("#newer-page").click(function () {
                var archiveAction = "@(Url.Action(MVC.Default.Archive()))";
                $("#list").load(archiveAction, {
                    @(MVC.Default.ArchiveParams.page): "@(Model.NewerPage.Value)"
                });
                return false;
            });
        </text>
    }

    @if(Model.OlderPage.HasValue)
    {
        <text>
            $("#older-page").click(function () {
                var archiveAction = "@(Url.Action(MVC.Default.Archive()))";
                $("#list").load(archiveAction, {                    
                    @(MVC.Default.ArchiveParams.page): "@(Model.OlderPage.Value)"
                });
                return false;
            });
        </text>
    }
</script>